<script type="text/javascript">
  jQuery('#tabs a').click(function (e) {
    e.preventDefault();
    jQuery(this).tab('show');
  })
</script>

<script type="text/javascript">
  jQuery(function () {
      var chart;
      jQuery(document).ready(function() {
          chart = new Highcharts.Chart({
              chart: {
                  renderTo: 'pieChart',
                  plotBackgroundColor: null,
                  plotBorderWidth: null,
                  plotShadow: true
              },
              title: {
                  text: 'expenses categories'
              },
              tooltip: {
                pointFormat: '{series.name}: <b>{point.percentage}%</b>',
                percentageDecimals: 1
              },
              plotOptions: {
                  pie: {
                      allowPointSelect: true,
                      cursor: 'pointer',
                      dataLabels: {
                          enabled: true,
                          color: '#000000',
                          connectorColor: '#000000',
                          formatter: function() {
                              return '<b>'+ this.point.name +'</b>: '+ this.y.toFixed(2) +' zł';
                          }
                      }
                  }
              },
              series: [{
                  type: 'pie',
                  name: 'share',
                  data: <%= @chart_data.to_json.html_safe %>
              }]
          });
      });

});
</script>
<% title "Expenses" %>
<div id="tabs">
  <ul class="nav nav-tabs">
    <li><a href="#tabular" data-toggle="tab">table</a></li>
    <li><a href="#charts" data-toggle="tab">charts</a></li>
  </ul>
</div>

<div class="tab-content">
  <div class="tab-pane active" id="tabular">
    <table class="table table-striped table-hover table-condensed">
      <thead>
        <tr>
          <th>no.</th>
          <th>description</th>
          <th class="amount">amount</th>
          <th>date</th>
          <th>tags</th>
          <th></th>
        </tr>
      </thead>

    <%
    sum = 0;
    id = 0;
    @expenses.each do |expense|
      sum += expense.amount
      id += 1
      %>
      <tr>
        <td><%= id %></td>
        <td><%= link_to expense.description, expense %></td>
        <td class="amount"><%= "%.2f" % expense.amount %> zł</td>
        <td><%= expense.date %></td>
        <td>
          <% tags = []
            expense.expenses_tags_association.each do |tag_id| %>
              <% tags.push(link_to tag_id.tag.name, tag_id.tag, {:target => '_blank'}) %>
            <% end %>
          <%= tags.to_sentence.html_safe %>
        </td>
        <td>
          <%= link_to '<i class="icon-edit"></i>'.html_safe, edit_expense_path(expense), :title => 'edit' %>
          <%= link_to '<i class="icon-trash"></i>'.html_safe, expense, method: :delete, data: { confirm: 'Are you sure?' }, :title => 'delete' %>
        </td>
      </tr>
    <% end %>
    <% if sum > 0 %>
      <tr class="info">
        <td></td>
        <td>sum</td>
        <td class="amount"><%= "%.2f" % sum %> zł</td>
        <td></td>
        <td></td>
        <td></td>
      </tr>
    <% end %>
    </table>

    <%= link_to '<i class="icon-pencil"></i> new expense'.html_safe, new_expense_path, :title => 'new' %>
  </div>
  <div class="tab-pane" id="charts">
    charts will be here :)
    <div id="pieChart"></div>
  </div>
</div>
